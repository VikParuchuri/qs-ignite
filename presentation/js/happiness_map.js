$(document).ready(function() {
    var data = "[[\"-71.11406\",\"42.37665\",\" 7.500000\"],[\"-71.10138\",\"42.35973\",\" 8.750000\"],[\"-71.10136\",\"42.35963\",\" 7.000000\"],[\"-71.10132\",\"42.35967\",\"10.000000\"],[\"-71.10132\",\"42.35954\",\" 7.500000\"],[\"-71.06880\",\"42.35281\",\" 8.750000\"],[\"-71.10132\",\"42.35966\",\" 5.000000\"],[\"-71.10132\",\"42.35961\",\" 7.500000\"],[\"-71.10133\",\"42.35961\",\" 6.000000\"],[\"-71.10133\",\"42.35961\",\" 7.500000\"],[\"-71.10134\",\"42.35964\",\"10.000000\"],[\"-71.10131\",\"42.35966\",\" 6.000000\"],[\"-71.10134\",\"42.35962\",\" 7.000000\"],[\"-71.10131\",\"42.35966\",\" 7.000000\"],[\"-71.10127\",\"42.35973\",\" 6.000000\"],[\"-71.10130\",\"42.35974\",\" 6.000000\"],[\"-71.10128\",\"42.35972\",\" 7.500000\"],[\"-71.10131\",\"42.35972\",\" 5.000000\"],[\"-71.10136\",\"42.35961\",\" 7.000000\"],[\"-71.10130\",\"42.35968\",\" 6.000000\"],[\"-71.10135\",\"42.35964\",\" 7.500000\"],[\"-71.10134\",\"42.35961\",\" 6.000000\"],[\"-71.10137\",\"42.35962\",\" 7.500000\"],[\"-71.10135\",\"42.35961\",\" 6.250000\"],[\"-71.10138\",\"42.35962\",\" 5.000000\"],[\"-73.98375\",\"40.74383\",\" 7.500000\"],[\"-73.92106\",\"40.79765\",\" 5.000000\"],[\"-71.10110\",\"42.35984\",\" 7.500000\"],[\"-71.10136\",\"42.35961\",\" 7.000000\"],[\"-94.71437\",\"38.90806\",\"10.000000\"],[\"-94.82543\",\"38.60166\",\" 9.000000\"],[\"-71.10145\",\"42.35963\",\" 7.500000\"],[\"-71.10141\",\"42.35968\",\" 6.000000\"],[\"-71.10142\",\"42.35960\",\" 6.000000\"],[\"-71.10144\",\"42.35961\",\" 5.000000\"],[\"-71.10146\",\"42.35960\",\" 5.000000\"],[\"-71.10139\",\"42.35966\",\" 6.000000\"],[\"-71.10144\",\"42.35962\",\" 7.000000\"],[\"-71.10144\",\"42.35961\",\" 6.666667\"],[\"-71.10141\",\"42.35960\",\"10.000000\"],[\"-71.10140\",\"42.35962\",\" 5.000000\"],[\"-71.10140\",\"42.35962\",\" 8.333333\"],[\"-71.10141\",\"42.35965\",\" 8.333333\"],[\"-71.10135\",\"42.35970\",\" 7.000000\"],[\"-71.10138\",\"42.35962\",\" 8.333333\"],[\"-71.10138\",\"42.35962\",\" 6.000000\"],[\"-71.10142\",\"42.35961\",\" 7.000000\"],[\"-71.10135\",\"42.35968\",\" 6.666667\"],[\"-71.10139\",\"42.35960\",\"10.000000\"],[\"-71.10136\",\"42.35962\",\" 7.000000\"],[\"-71.10140\",\"42.35962\",\" 6.666667\"],[\"-71.10134\",\"42.35970\",\" 4.000000\"],[\"-71.10139\",\"42.35961\",\" 8.000000\"],[\"-71.10140\",\"42.35962\",\" 7.000000\"],[\"-71.10140\",\"42.35962\",\" 8.000000\"],[\"-71.10140\",\"42.35962\",\" 7.000000\"],[\"-71.10136\",\"42.35966\",\" 8.333333\"],[\"-71.10140\",\"42.35963\",\" 7.000000\"],[\"-71.10026\",\"42.36253\",\"10.000000\"],[\"-71.10139\",\"42.35962\",\" 3.000000\"],[\"-71.10139\",\"42.35963\",\" 7.000000\"],[\"-71.10138\",\"42.35963\",\"10.000000\"],[\"-71.10140\",\"42.35962\",\" 6.000000\"],[\"-71.10140\",\"42.35964\",\"10.000000\"],[\"-71.10140\",\"42.35961\",\" 6.666667\"],[\"-71.10139\",\"42.35963\",\" 5.000000\"],[\"-71.10137\",\"42.35968\",\" 9.000000\"],[\"-71.10141\",\"42.35962\",\" 5.000000\"],[\"-71.10136\",\"42.35967\",\" 6.000000\"],[\"-71.10141\",\"42.35962\",\"10.000000\"],[\"-71.10137\",\"42.35965\",\" 7.000000\"],[\"-71.10136\",\"42.35970\",\" 5.000000\"],[\"-71.13165\",\"42.35291\",\"10.000000\"],[\"-71.10137\",\"42.35966\",\" 6.666667\"],[\"-71.10141\",\"42.35962\",\"10.000000\"],[\"-71.10140\",\"42.35962\",\"10.000000\"],[\"-71.10142\",\"42.35962\",\" 7.000000\"],[\"-71.10141\",\"42.35961\",\" 5.000000\"],[\"-71.10141\",\"42.35961\",\" 4.000000\"],[\"-71.10143\",\"42.35960\",\"10.000000\"],[\"-71.10141\",\"42.35964\",\" 4.000000\"],[\"-71.10141\",\"42.35960\",\" 5.000000\"],[\"-71.09959\",\"42.38709\",\"10.000000\"],[\"-71.10136\",\"42.35973\",\" 7.000000\"],[\"-71.10140\",\"42.35971\",\"10.000000\"],[\"-71.10134\",\"42.35973\",\"10.000000\"],[\"-71.10138\",\"42.35969\",\" 6.000000\"],[\"-71.10035\",\"42.36259\",\"10.000000\"],[\"-71.10139\",\"42.35970\",\" 6.666667\"],[\"-71.10142\",\"42.35969\",\"10.000000\"],[\"-71.10141\",\"42.35967\",\" 6.666667\"],[\"-71.10140\",\"42.35974\",\" 6.000000\"],[\"-71.10139\",\"42.35971\",\" 3.000000\"],[\"-71.10136\",\"42.35971\",\" 7.000000\"],[\"-71.10138\",\"42.35969\",\" 6.000000\"]]";

    var json_data = JSON.parse(data);
    var map = L.map('happiness-map').setView([42.35962, -71.10140], 13);
    L.tileLayer('http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png', {
        attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
        subdomains: 'abcd',
        minZoom: 1,
        maxZoom: 17
    }).addTo(map);

    var rainbow = new Rainbow();
    rainbow.setSpectrum('red', 'yellow', 'green');
    rainbow.setNumberRange(0, 10);

    for(var i=0;i<json_data.length;i++){
        var jd = json_data[i];
        var lat = parseFloat(jd[1]);
        var long = parseFloat(jd[0]);

        var color = "#" + rainbow.colourAt(jd[2]);
        var circle = L.circle([lat, long], 300, {
            color: color,
            fillColor: color,
            fillOpacity: 0.7,
            fill: true
        }).addTo(map);
    }
});